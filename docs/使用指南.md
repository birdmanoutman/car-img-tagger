# 🚗 汽车图片智能标签系统 - 完整使用指南

## 🎯 系统概述

这是一个基于AI的汽车图片智能标注和管理系统，成功实现了从数据预处理到AI标注再到Web管理的完整流程。

## 📊 系统现状

✅ **已完成功能**:
- 数据预处理: 880张角度样本图片已处理完成
- 数据库系统: SQLite数据库已建立，包含800条记录
- AI模型: CLIP模型已集成，支持智能标注
- Web界面: FastAPI后端 + 响应式前端已开发
- 标注流水线: 半自动标注工作流已建立

## 🚀 快速开始

### 1. 启动 Web 应用
```bash
python scripts/run_server.py
# 然后访问 http://localhost:8000
```

### 2. 执行批量自动标注
```bash
python scripts/auto_tag.py --max-per-brand 50
```

### 3. 生成人工审核队列
```bash
python scripts/build_review_queue.py processed_data/auto_annotated_dataset.csv
```

## 📋 详细使用说明

### 数据预处理模块
- 角度与品牌样本位于 `各标签素材/` 与 `图片素材/`。
- 预处理输出写入 `processed_data/`，统计信息在 `processed_data/statistics.json`。
- 如需重新划分数据集，可参考 `scripts/train_angle_classifier.py` 中的数据加载逻辑。

### AI模型模块
```bash
# 运行自动标注
python scripts/auto_tag.py --max-per-brand 200

# 功能:
# - 使用 SigLIP 模型识别汽车特征
# - 自动生成角度、品牌、风格、内饰部件标签
# - 提供置信度与不确定性评分
# - 支持批量处理与TensorRT导出
```

### 数据库模块
- SQLite 文件默认位于 `databases/car_tags.db`。
- 可通过 `car_img_tagger.database.CarTagDatabase` 访问增删改查接口。
- 标注结果落地在 `processed_data/auto_annotated_dataset.csv`，可由 `CarTagDatabase.import_from_csv` 导入。

### 标注流水线
```bash
# 生成审核队列
python scripts/build_review_queue.py processed_data/auto_annotated_dataset.csv

# 功能:
# - 读取自动标注结果
# - 基于熵/边际筛选低置信度样本
# - 生成 `processed_data/review_queue.json` 供 Label Studio 导入
```

### Web应用
```bash
# 启动Web服务
python scripts/run_server.py

# 功能:
# - 图片浏览和搜索
# - 标签管理和编辑
# - 统计信息展示
# - 响应式界面
```

## 🔧 系统配置

### 配置文件 (config.py)
```python
# 数据路径配置
DATA_CONFIG = {
    "brand_images": "图片素材",      # 品牌图片目录
    "angle_samples": "各标签素材",   # 角度样本目录
    "processed_data": "processed_data",  # 处理后数据
    "databases": "databases",       # 数据库目录
}

# 标签体系配置
LABEL_CONFIG = {
    "angles": ["1-前45", "2-正侧", ...],  # 24个角度
    "brands": ["Cadillac", "Ferrari", ...],  # 8个品牌
    "styles": ["新能源", "运动", ...],     # 16种风格
}

# 模型配置
MODEL_CONFIG = {
    "clip": {"model_name": "ViT-B/32"},
    "yolo": {"model_size": "yolov8n.pt"},
}
```

## 📊 数据统计

### 当前数据状态
```
总图片数: 800张
├── 品牌分布:
│   ├── Cadillac: 204张
│   ├── Honda: 136张
│   ├── MINI: 71张
│   ├── Nissan: 54张
│   ├── Smart: 21张
│   ├── Porsche: 16张
│   ├── Ferrari: 15张
│   └── Unknown: 283张
├── 角度分布:
│   ├── 1-前45: 170张
│   ├── 10-内饰: 119张
│   ├── 3-后45: 88张
│   ├── 2-正侧: 78张
│   └── 其他20个角度...
└── 数据源: angle_samples (100%)
```

## 🌐 Web界面功能

### 主要页面
1. **首页**: 系统概览和统计信息
2. **图片浏览**: 按条件筛选和浏览图片
3. **搜索功能**: 多维度搜索和过滤
4. **标签管理**: 查看和编辑图片标签

### API接口
```
GET /api/images          # 获取图片列表
GET /api/image/{id}      # 获取图片详情
POST /api/image/{id}/tags # 更新图片标签
GET /api/search          # 搜索图片
GET /api/statistics      # 获取统计信息
GET /api/brands          # 获取品牌列表
GET /api/angles          # 获取角度列表
GET /api/styles          # 获取风格列表
GET /image/{id}          # 图片服务
GET /thumbnail/{id}      # 缩略图服务
```

## 🤖 AI标注流程

### 1. 自动标注
```python
# 使用CLIP模型进行标注
tagger = CarImageTagger()
result = tagger.process_single_image("path/to/image.jpg")

# 结果包含:
# - 角度识别 (如: "1-前45")
# - 品牌识别 (如: "Cadillac")
# - 风格识别 (如: "新能源")
# - 置信度评分 (0-1)
```

### 2. 标注流水线
```python
# 创建标注批次
pipeline = AnnotationPipeline()
batch_id = pipeline.create_annotation_batch(brand_path, batch_size=50)

# 自动标注
batch_info = pipeline.auto_annotate_batch(batch_id)

# 生成审核队列
review_queue = pipeline.generate_review_queue(batch_id)

# 导出Label Studio格式
ls_project = pipeline.export_for_label_studio(batch_id)
```

## 📁 文件结构说明

```
AI汽车图片打标签/
├── src/
│   └── car_img_tagger/
│       ├── config.py             # 系统配置
│       ├── auto_tagging.py       # 自动标注
│       ├── active_learning.py    # 主动学习策略
│       ├── database.py           # 数据库操作
│       ├── color_detection.py    # 颜色识别
│       ├── deployment.py         # 部署工具
│       ├── modeling/vision_language.py  # 视觉语言模型
│       └── web/app.py            # Web 应用入口
├── scripts/                      # 命令行脚本集合
│   ├── run_server.py             # Web 服务
│   ├── auto_tag.py               # 批量标注
│   ├── build_review_queue.py     # 审核队列
│   ├── train_angle_classifier.py # 模型训练
│   └── run_enhanced_brand_tagger.py # 品牌标注
├── 图片素材/                      # 原始品牌图片
├── 各标签素材/                    # 角度样本
├── processed_data/                # 处理后数据
├── databases/                     # 数据库文件
├── templates/                     # HTML 模板
├── static/                        # 静态文件
└── docs/                          # 文档资源
    ├── README.md             # 项目说明
    ├── 使用指南.md           # 本文件
    └── 项目总结.md           # 项目总结
```

## 🔍 常见问题

### Q: 如何添加新的汽车品牌？
A: 在`config.py`的`LABEL_CONFIG["brands"]`中添加新品牌，然后重新运行数据预处理。

### Q: 如何提高AI标注准确率？
A: 可以调整CLIP模型的提示词，或者使用更多训练数据微调模型。

### Q: 如何批量处理大量图片？
A: 使用`annotation_pipeline.py`中的批次处理功能，可以分批处理大量图片。

### Q: Web应用无法启动怎么办？
A: 检查依赖是否安装完整，运行`pip install -r requirements.txt`。

### Q: 如何导出标注结果？
A: 系统支持导出CSV格式和Label Studio格式，可以通过数据库模块或标注流水线导出。

## 🎯 最佳实践

### 1. 数据管理
- 定期备份数据库文件
- 使用版本控制管理配置文件
- 保持原始数据的完整性

### 2. AI标注
- 先运行小批量测试
- 设置合适的置信度阈值
- 定期审核AI标注结果

### 3. 系统维护
- 监控系统性能
- 定期更新依赖包
- 备份重要数据

## 🚀 扩展建议

### 短期优化
- 添加更多AI模型支持
- 优化Web界面性能
- 增加批量操作功能

### 长期发展
- 集成深度学习训练
- 开发移动端应用
- 构建知识图谱

## 📞 技术支持

如遇到问题，请：
1. 查看系统日志
2. 检查配置文件
3. 运行演示应用测试
4. 参考项目文档

---

**🎉 恭喜！您已成功部署汽车图片智能标签系统！**

这个系统为您提供了完整的汽车图片智能标注解决方案，从数据预处理到AI标注，从数据库管理到Web界面，每个环节都经过精心设计和实现。现在您可以开始使用这个强大的工具来管理您的汽车图片库了！
