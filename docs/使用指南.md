# ğŸš— æ±½è½¦å›¾ç‰‡æ™ºèƒ½æ ‡ç­¾ç³»ç»Ÿ - å®Œæ•´ä½¿ç”¨æŒ‡å—

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºAIçš„æ±½è½¦å›¾ç‰‡æ™ºèƒ½æ ‡æ³¨å’Œç®¡ç†ç³»ç»Ÿï¼ŒæˆåŠŸå®ç°äº†ä»æ•°æ®é¢„å¤„ç†åˆ°AIæ ‡æ³¨å†åˆ°Webç®¡ç†çš„å®Œæ•´æµç¨‹ã€‚

## ğŸ“Š ç³»ç»Ÿç°çŠ¶

âœ… **å·²å®ŒæˆåŠŸèƒ½**:
- æ•°æ®é¢„å¤„ç†: 880å¼ è§’åº¦æ ·æœ¬å›¾ç‰‡å·²å¤„ç†å®Œæˆ
- æ•°æ®åº“ç³»ç»Ÿ: SQLiteæ•°æ®åº“å·²å»ºç«‹ï¼ŒåŒ…å«800æ¡è®°å½•
- AIæ¨¡å‹: CLIPæ¨¡å‹å·²é›†æˆï¼Œæ”¯æŒæ™ºèƒ½æ ‡æ³¨
- Webç•Œé¢: FastAPIåç«¯ + å“åº”å¼å‰ç«¯å·²å¼€å‘
- æ ‡æ³¨æµæ°´çº¿: åŠè‡ªåŠ¨æ ‡æ³¨å·¥ä½œæµå·²å»ºç«‹

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨ Web åº”ç”¨
```bash
python scripts/run_server.py
# ç„¶åè®¿é—® http://localhost:8000
```

### 2. æ‰§è¡Œæ‰¹é‡è‡ªåŠ¨æ ‡æ³¨
```bash
python scripts/auto_tag.py --max-per-brand 50
```

### 3. ç”Ÿæˆäººå·¥å®¡æ ¸é˜Ÿåˆ—
```bash
python scripts/build_review_queue.py processed_data/auto_annotated_dataset.csv
```

## ğŸ“‹ è¯¦ç»†ä½¿ç”¨è¯´æ˜

### æ•°æ®é¢„å¤„ç†æ¨¡å—
- è§’åº¦ä¸å“ç‰Œæ ·æœ¬ä½äº `å„æ ‡ç­¾ç´ æ/` ä¸ `å›¾ç‰‡ç´ æ/`ã€‚
- é¢„å¤„ç†è¾“å‡ºå†™å…¥ `processed_data/`ï¼Œç»Ÿè®¡ä¿¡æ¯åœ¨ `processed_data/statistics.json`ã€‚
- å¦‚éœ€é‡æ–°åˆ’åˆ†æ•°æ®é›†ï¼Œå¯å‚è€ƒ `scripts/train_angle_classifier.py` ä¸­çš„æ•°æ®åŠ è½½é€»è¾‘ã€‚

### AIæ¨¡å‹æ¨¡å—
```bash
# è¿è¡Œè‡ªåŠ¨æ ‡æ³¨
python scripts/auto_tag.py --max-per-brand 200

# åŠŸèƒ½:
# - ä½¿ç”¨ SigLIP æ¨¡å‹è¯†åˆ«æ±½è½¦ç‰¹å¾
# - è‡ªåŠ¨ç”Ÿæˆè§’åº¦ã€å“ç‰Œã€é£æ ¼ã€å†…é¥°éƒ¨ä»¶æ ‡ç­¾
# - æä¾›ç½®ä¿¡åº¦ä¸ä¸ç¡®å®šæ€§è¯„åˆ†
# - æ”¯æŒæ‰¹é‡å¤„ç†ä¸TensorRTå¯¼å‡º
```

### æ•°æ®åº“æ¨¡å—
- SQLite æ–‡ä»¶é»˜è®¤ä½äº `databases/car_tags.db`ã€‚
- å¯é€šè¿‡ `car_img_tagger.database.CarTagDatabase` è®¿é—®å¢åˆ æ”¹æŸ¥æ¥å£ã€‚
- æ ‡æ³¨ç»“æœè½åœ°åœ¨ `processed_data/auto_annotated_dataset.csv`ï¼Œå¯ç”± `CarTagDatabase.import_from_csv` å¯¼å…¥ã€‚

### æ ‡æ³¨æµæ°´çº¿
```bash
# ç”Ÿæˆå®¡æ ¸é˜Ÿåˆ—
python scripts/build_review_queue.py processed_data/auto_annotated_dataset.csv

# åŠŸèƒ½:
# - è¯»å–è‡ªåŠ¨æ ‡æ³¨ç»“æœ
# - åŸºäºç†µ/è¾¹é™…ç­›é€‰ä½ç½®ä¿¡åº¦æ ·æœ¬
# - ç”Ÿæˆ `processed_data/review_queue.json` ä¾› Label Studio å¯¼å…¥
```

### Webåº”ç”¨
```bash
# å¯åŠ¨WebæœåŠ¡
python scripts/run_server.py

# åŠŸèƒ½:
# - å›¾ç‰‡æµè§ˆå’Œæœç´¢
# - æ ‡ç­¾ç®¡ç†å’Œç¼–è¾‘
# - ç»Ÿè®¡ä¿¡æ¯å±•ç¤º
# - å“åº”å¼ç•Œé¢
```

## ğŸ”§ ç³»ç»Ÿé…ç½®

### é…ç½®æ–‡ä»¶ (config.py)
```python
# æ•°æ®è·¯å¾„é…ç½®
DATA_CONFIG = {
    "brand_images": "å›¾ç‰‡ç´ æ",      # å“ç‰Œå›¾ç‰‡ç›®å½•
    "angle_samples": "å„æ ‡ç­¾ç´ æ",   # è§’åº¦æ ·æœ¬ç›®å½•
    "processed_data": "processed_data",  # å¤„ç†åæ•°æ®
    "databases": "databases",       # æ•°æ®åº“ç›®å½•
}

# æ ‡ç­¾ä½“ç³»é…ç½®
LABEL_CONFIG = {
    "angles": ["1-å‰45", "2-æ­£ä¾§", ...],  # 24ä¸ªè§’åº¦
    "brands": ["Cadillac", "Ferrari", ...],  # 8ä¸ªå“ç‰Œ
    "styles": ["æ–°èƒ½æº", "è¿åŠ¨", ...],     # 16ç§é£æ ¼
}

# æ¨¡å‹é…ç½®
MODEL_CONFIG = {
    "clip": {"model_name": "ViT-B/32"},
    "yolo": {"model_size": "yolov8n.pt"},
}
```

## ğŸ“Š æ•°æ®ç»Ÿè®¡

### å½“å‰æ•°æ®çŠ¶æ€
```
æ€»å›¾ç‰‡æ•°: 800å¼ 
â”œâ”€â”€ å“ç‰Œåˆ†å¸ƒ:
â”‚   â”œâ”€â”€ Cadillac: 204å¼ 
â”‚   â”œâ”€â”€ Honda: 136å¼ 
â”‚   â”œâ”€â”€ MINI: 71å¼ 
â”‚   â”œâ”€â”€ Nissan: 54å¼ 
â”‚   â”œâ”€â”€ Smart: 21å¼ 
â”‚   â”œâ”€â”€ Porsche: 16å¼ 
â”‚   â”œâ”€â”€ Ferrari: 15å¼ 
â”‚   â””â”€â”€ Unknown: 283å¼ 
â”œâ”€â”€ è§’åº¦åˆ†å¸ƒ:
â”‚   â”œâ”€â”€ 1-å‰45: 170å¼ 
â”‚   â”œâ”€â”€ 10-å†…é¥°: 119å¼ 
â”‚   â”œâ”€â”€ 3-å45: 88å¼ 
â”‚   â”œâ”€â”€ 2-æ­£ä¾§: 78å¼ 
â”‚   â””â”€â”€ å…¶ä»–20ä¸ªè§’åº¦...
â””â”€â”€ æ•°æ®æº: angle_samples (100%)
```

## ğŸŒ Webç•Œé¢åŠŸèƒ½

### ä¸»è¦é¡µé¢
1. **é¦–é¡µ**: ç³»ç»Ÿæ¦‚è§ˆå’Œç»Ÿè®¡ä¿¡æ¯
2. **å›¾ç‰‡æµè§ˆ**: æŒ‰æ¡ä»¶ç­›é€‰å’Œæµè§ˆå›¾ç‰‡
3. **æœç´¢åŠŸèƒ½**: å¤šç»´åº¦æœç´¢å’Œè¿‡æ»¤
4. **æ ‡ç­¾ç®¡ç†**: æŸ¥çœ‹å’Œç¼–è¾‘å›¾ç‰‡æ ‡ç­¾

### APIæ¥å£
```
GET /api/images          # è·å–å›¾ç‰‡åˆ—è¡¨
GET /api/image/{id}      # è·å–å›¾ç‰‡è¯¦æƒ…
POST /api/image/{id}/tags # æ›´æ–°å›¾ç‰‡æ ‡ç­¾
GET /api/search          # æœç´¢å›¾ç‰‡
GET /api/statistics      # è·å–ç»Ÿè®¡ä¿¡æ¯
GET /api/brands          # è·å–å“ç‰Œåˆ—è¡¨
GET /api/angles          # è·å–è§’åº¦åˆ—è¡¨
GET /api/styles          # è·å–é£æ ¼åˆ—è¡¨
GET /image/{id}          # å›¾ç‰‡æœåŠ¡
GET /thumbnail/{id}      # ç¼©ç•¥å›¾æœåŠ¡
```

## ğŸ¤– AIæ ‡æ³¨æµç¨‹

### 1. è‡ªåŠ¨æ ‡æ³¨
```python
# ä½¿ç”¨CLIPæ¨¡å‹è¿›è¡Œæ ‡æ³¨
tagger = CarImageTagger()
result = tagger.process_single_image("path/to/image.jpg")

# ç»“æœåŒ…å«:
# - è§’åº¦è¯†åˆ« (å¦‚: "1-å‰45")
# - å“ç‰Œè¯†åˆ« (å¦‚: "Cadillac")
# - é£æ ¼è¯†åˆ« (å¦‚: "æ–°èƒ½æº")
# - ç½®ä¿¡åº¦è¯„åˆ† (0-1)
```

### 2. æ ‡æ³¨æµæ°´çº¿
```python
# åˆ›å»ºæ ‡æ³¨æ‰¹æ¬¡
pipeline = AnnotationPipeline()
batch_id = pipeline.create_annotation_batch(brand_path, batch_size=50)

# è‡ªåŠ¨æ ‡æ³¨
batch_info = pipeline.auto_annotate_batch(batch_id)

# ç”Ÿæˆå®¡æ ¸é˜Ÿåˆ—
review_queue = pipeline.generate_review_queue(batch_id)

# å¯¼å‡ºLabel Studioæ ¼å¼
ls_project = pipeline.export_for_label_studio(batch_id)
```

## ğŸ“ æ–‡ä»¶ç»“æ„è¯´æ˜

```
AIæ±½è½¦å›¾ç‰‡æ‰“æ ‡ç­¾/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ car_img_tagger/
â”‚       â”œâ”€â”€ config.py             # ç³»ç»Ÿé…ç½®
â”‚       â”œâ”€â”€ auto_tagging.py       # è‡ªåŠ¨æ ‡æ³¨
â”‚       â”œâ”€â”€ active_learning.py    # ä¸»åŠ¨å­¦ä¹ ç­–ç•¥
â”‚       â”œâ”€â”€ database.py           # æ•°æ®åº“æ“ä½œ
â”‚       â”œâ”€â”€ color_detection.py    # é¢œè‰²è¯†åˆ«
â”‚       â”œâ”€â”€ deployment.py         # éƒ¨ç½²å·¥å…·
â”‚       â”œâ”€â”€ modeling/vision_language.py  # è§†è§‰è¯­è¨€æ¨¡å‹
â”‚       â””â”€â”€ web/app.py            # Web åº”ç”¨å…¥å£
â”œâ”€â”€ scripts/                      # å‘½ä»¤è¡Œè„šæœ¬é›†åˆ
â”‚   â”œâ”€â”€ run_server.py             # Web æœåŠ¡
â”‚   â”œâ”€â”€ auto_tag.py               # æ‰¹é‡æ ‡æ³¨
â”‚   â”œâ”€â”€ build_review_queue.py     # å®¡æ ¸é˜Ÿåˆ—
â”‚   â”œâ”€â”€ train_angle_classifier.py # æ¨¡å‹è®­ç»ƒ
â”‚   â””â”€â”€ run_enhanced_brand_tagger.py # å“ç‰Œæ ‡æ³¨
â”œâ”€â”€ å›¾ç‰‡ç´ æ/                      # åŸå§‹å“ç‰Œå›¾ç‰‡
â”œâ”€â”€ å„æ ‡ç­¾ç´ æ/                    # è§’åº¦æ ·æœ¬
â”œâ”€â”€ processed_data/                # å¤„ç†åæ•°æ®
â”œâ”€â”€ databases/                     # æ•°æ®åº“æ–‡ä»¶
â”œâ”€â”€ templates/                     # HTML æ¨¡æ¿
â”œâ”€â”€ static/                        # é™æ€æ–‡ä»¶
â””â”€â”€ docs/                          # æ–‡æ¡£èµ„æº
    â”œâ”€â”€ README.md             # é¡¹ç›®è¯´æ˜
    â”œâ”€â”€ ä½¿ç”¨æŒ‡å—.md           # æœ¬æ–‡ä»¶
    â””â”€â”€ é¡¹ç›®æ€»ç»“.md           # é¡¹ç›®æ€»ç»“
```

## ğŸ” å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æ·»åŠ æ–°çš„æ±½è½¦å“ç‰Œï¼Ÿ
A: åœ¨`config.py`çš„`LABEL_CONFIG["brands"]`ä¸­æ·»åŠ æ–°å“ç‰Œï¼Œç„¶åé‡æ–°è¿è¡Œæ•°æ®é¢„å¤„ç†ã€‚

### Q: å¦‚ä½•æé«˜AIæ ‡æ³¨å‡†ç¡®ç‡ï¼Ÿ
A: å¯ä»¥è°ƒæ•´CLIPæ¨¡å‹çš„æç¤ºè¯ï¼Œæˆ–è€…ä½¿ç”¨æ›´å¤šè®­ç»ƒæ•°æ®å¾®è°ƒæ¨¡å‹ã€‚

### Q: å¦‚ä½•æ‰¹é‡å¤„ç†å¤§é‡å›¾ç‰‡ï¼Ÿ
A: ä½¿ç”¨`annotation_pipeline.py`ä¸­çš„æ‰¹æ¬¡å¤„ç†åŠŸèƒ½ï¼Œå¯ä»¥åˆ†æ‰¹å¤„ç†å¤§é‡å›¾ç‰‡ã€‚

### Q: Webåº”ç”¨æ— æ³•å¯åŠ¨æ€ä¹ˆåŠï¼Ÿ
A: æ£€æŸ¥ä¾èµ–æ˜¯å¦å®‰è£…å®Œæ•´ï¼Œè¿è¡Œ`pip install -r requirements.txt`ã€‚

### Q: å¦‚ä½•å¯¼å‡ºæ ‡æ³¨ç»“æœï¼Ÿ
A: ç³»ç»Ÿæ”¯æŒå¯¼å‡ºCSVæ ¼å¼å’ŒLabel Studioæ ¼å¼ï¼Œå¯ä»¥é€šè¿‡æ•°æ®åº“æ¨¡å—æˆ–æ ‡æ³¨æµæ°´çº¿å¯¼å‡ºã€‚

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æ•°æ®ç®¡ç†
- å®šæœŸå¤‡ä»½æ•°æ®åº“æ–‡ä»¶
- ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç®¡ç†é…ç½®æ–‡ä»¶
- ä¿æŒåŸå§‹æ•°æ®çš„å®Œæ•´æ€§

### 2. AIæ ‡æ³¨
- å…ˆè¿è¡Œå°æ‰¹é‡æµ‹è¯•
- è®¾ç½®åˆé€‚çš„ç½®ä¿¡åº¦é˜ˆå€¼
- å®šæœŸå®¡æ ¸AIæ ‡æ³¨ç»“æœ

### 3. ç³»ç»Ÿç»´æŠ¤
- ç›‘æ§ç³»ç»Ÿæ€§èƒ½
- å®šæœŸæ›´æ–°ä¾èµ–åŒ…
- å¤‡ä»½é‡è¦æ•°æ®

## ğŸš€ æ‰©å±•å»ºè®®

### çŸ­æœŸä¼˜åŒ–
- æ·»åŠ æ›´å¤šAIæ¨¡å‹æ”¯æŒ
- ä¼˜åŒ–Webç•Œé¢æ€§èƒ½
- å¢åŠ æ‰¹é‡æ“ä½œåŠŸèƒ½

### é•¿æœŸå‘å±•
- é›†æˆæ·±åº¦å­¦ä¹ è®­ç»ƒ
- å¼€å‘ç§»åŠ¨ç«¯åº”ç”¨
- æ„å»ºçŸ¥è¯†å›¾è°±

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
2. æ£€æŸ¥é…ç½®æ–‡ä»¶
3. è¿è¡Œæ¼”ç¤ºåº”ç”¨æµ‹è¯•
4. å‚è€ƒé¡¹ç›®æ–‡æ¡£

---

**ğŸ‰ æ­å–œï¼æ‚¨å·²æˆåŠŸéƒ¨ç½²æ±½è½¦å›¾ç‰‡æ™ºèƒ½æ ‡ç­¾ç³»ç»Ÿï¼**

è¿™ä¸ªç³»ç»Ÿä¸ºæ‚¨æä¾›äº†å®Œæ•´çš„æ±½è½¦å›¾ç‰‡æ™ºèƒ½æ ‡æ³¨è§£å†³æ–¹æ¡ˆï¼Œä»æ•°æ®é¢„å¤„ç†åˆ°AIæ ‡æ³¨ï¼Œä»æ•°æ®åº“ç®¡ç†åˆ°Webç•Œé¢ï¼Œæ¯ä¸ªç¯èŠ‚éƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡å’Œå®ç°ã€‚ç°åœ¨æ‚¨å¯ä»¥å¼€å§‹ä½¿ç”¨è¿™ä¸ªå¼ºå¤§çš„å·¥å…·æ¥ç®¡ç†æ‚¨çš„æ±½è½¦å›¾ç‰‡åº“äº†ï¼
